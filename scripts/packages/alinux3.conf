# Alibaba Cloud Linux 3 system package configuration
# Applicable to: Alibaba Cloud Linux 3 (alinux/3)

# Check if sudo is needed (usually runs as root in Docker containers)
SUDO_CMD=""
if [ "$(id -u)" -ne 0 ]; then
    SUDO_CMD="sudo"
fi

# Alibaba Cloud Linux 3 uses dnf
if command -v dnf &> /dev/null; then
    PKG_MANAGER="dnf"
    PKG_UPDATE_CMD="timeout 120 ${SUDO_CMD} dnf check-update || true"
    PKG_INSTALL_CMD="${SUDO_CMD} dnf install -y"
else
    PKG_MANAGER="yum"
    PKG_UPDATE_CMD="timeout 120 ${SUDO_CMD} yum check-update || true"
    PKG_INSTALL_CMD="${SUDO_CMD} yum install -y"
fi

# List of packages to install
PACKAGES=(
    # Build tools
    "ca-certificates"
    "cmake"
    "curl"
    "diffutils"
    "file"
    "gcc"
    "gcc-c++"
    "git"
    "make"
    "ninja-build"
    "patch"
    "pkgconfig"
    "python3.11"
    "tar"
    "unzip"
    "wget"
    "which"
    "xz"
    "zlib-devel"
)

# System-specific additional configuration commands (optional)
EXTRA_SETUP_COMMANDS=()

# Create python3 symbolic link (if it doesn't exist)
# Alibaba Cloud Linux 3 uses python3.11 by default
EXTRA_SETUP_COMMANDS+=(
    '${SUDO_CMD} test -f /usr/bin/python3.11 && ! test -f /usr/bin/python3 && ${SUDO_CMD} ln -sf /usr/bin/python3.11 /usr/bin/python3 || true'
    'echo "Using Python $(python3 --version 2>&1)"'
    'echo "Using CMake $(cmake --version | head -1)"'
)

